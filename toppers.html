<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸŽ“ Class Topper Certificate Generator â€” Noorussalam Madrasa</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=Amiri&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  --primary: #1e3a8a;
  --secondary: #fbbf24;
  --accent: #059669;
  --light: #f0f9ff;
  --dark: #0f172a;
  --white: #ffffff;
  --gray: #64748b;
  --gold: #d4af37;
  --silver: #c0c0c0;
  --gradient-primary: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
  --gradient-secondary: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  --gradient-accent: linear-gradient(135deg, #059669 0%, #10b981 100%);
  --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  --radius: 16px;
  --radius-lg: 24px;
  --radius-xl: 32px;
}

body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  color: var(--dark);
  min-height: 100vh;
  padding: 20px;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 300px;
  background: linear-gradient(135deg, rgba(30, 58, 138, 0.05) 0%, rgba(251, 191, 36, 0.05) 100%);
  z-index: -1;
}

.wrap {
  max-width: 1400px;
  margin: 0 auto;
  position: relative;
}

/* Header Section */
.header {
  text-align: center;
  margin-bottom: 60px;
  padding: 40px 30px;
  background: var(--white);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.header::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 8px;
  background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
}

.header-content {
  position: relative;
  z-index: 2;
}

.logo-container {
  margin-bottom: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.logo-icon {
  width: 100px;
  height: 100px;
  background: var(--gradient-primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 42px;
  color: var(--white);
  box-shadow: var(--shadow-lg);
  border: 4px solid var(--white);
  position: relative;
  overflow: hidden;
}

.logo-icon::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
  transform: rotate(45deg);
  animation: shine 3s infinite linear;
}

@keyframes shine {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.header h1 {
  font-family: "Playfair Display", serif;
  font-size: 42px;
  font-weight: 700;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin: 10px 0;
  letter-spacing: -0.5px;
}

.subtitle {
  font-size: 20px;
  color: var(--primary);
  font-weight: 500;
  margin: 10px 0;
  opacity: 0.9;
}

.tagline {
  display: inline-block;
  padding: 12px 28px;
  background: var(--gradient-secondary);
  color: var(--dark);
  font-weight: 600;
  border-radius: 50px;
  margin-top: 15px;
  box-shadow: var(--shadow-sm);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

/* Stats Section */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin: 40px 0;
}

.stat-card {
  background: var(--white);
  padding: 25px 20px;
  border-radius: var(--radius-lg);
  text-align: center;
  box-shadow: var(--shadow-md);
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-xl);
}

.stat-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-primary);
}

.stat-card:nth-child(2)::before {
  background: var(--gradient-secondary);
}

.stat-card:nth-child(3)::before {
  background: var(--gradient-accent);
}

.stat-card:nth-child(4)::before {
  background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
}

.stat-number {
  font-size: 42px;
  font-weight: 800;
  color: var(--primary);
  margin-bottom: 5px;
  line-height: 1;
}

.stat-label {
  font-size: 14px;
  color: var(--gray);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Instructions */
.guide-card {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
  border-radius: var(--radius-lg);
  padding: 30px;
  margin: 30px 0;
  border-left: 6px solid var(--secondary);
  box-shadow: var(--shadow-md);
}

.guide-card h3 {
  font-family: "Playfair Display", serif;
  font-size: 24px;
  color: var(--primary);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.guide-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  list-style: none;
}

.guide-item {
  background: var(--white);
  padding: 20px;
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  gap: 15px;
  box-shadow: var(--shadow-sm);
  transition: all 0.3s ease;
}

.guide-item:hover {
  transform: translateX(5px);
  box-shadow: var(--shadow-md);
}

.guide-icon {
  width: 50px;
  height: 50px;
  background: var(--gradient-primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--white);
  font-size: 20px;
  flex-shrink: 0;
}

.guide-text {
  font-weight: 500;
  color: var(--dark);
}

/* Search Section */
.search-container {
  background: var(--white);
  border-radius: var(--radius-xl);
  padding: 40px;
  margin: 40px 0;
  box-shadow: var(--shadow-xl);
  position: relative;
  overflow: hidden;
}

.search-container::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: var(--gradient-primary);
}

.search-header {
  text-align: center;
  margin-bottom: 30px;
}

.search-header h3 {
  font-family: "Playfair Display", serif;
  font-size: 28px;
  color: var(--primary);
  margin-bottom: 10px;
}

.search-header p {
  color: var(--gray);
  font-size: 16px;
}

.search-box {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

.search-input-wrapper {
  flex: 1;
  min-width: 300px;
  max-width: 500px;
  position: relative;
}

.search-input-wrapper i {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray);
  font-size: 18px;
}

#classSearch {
  width: 100%;
  padding: 18px 20px 18px 50px;
  border: 2px solid #e2e8f0;
  border-radius: var(--radius);
  font-size: 16px;
  font-weight: 500;
  color: var(--dark);
  background: var(--white);
  transition: all 0.3s ease;
  box-shadow: var(--shadow-sm);
}

#classSearch:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

.search-btn, .clear-search-btn {
  padding: 18px 35px;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: var(--shadow-md);
}

.search-btn {
  background: var(--gradient-primary);
  color: var(--white);
}

.clear-search-btn {
  background: var(--gradient-accent);
  color: var(--white);
}

.search-btn:hover, .clear-search-btn:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.class-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-top: 20px;
}

.class-filter-btn {
  padding: 12px 24px;
  background: var(--white);
  border: 2px solid #e2e8f0;
  border-radius: 50px;
  color: var(--primary);
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.class-filter-btn:hover {
  background: rgba(30, 58, 138, 0.05);
  border-color: var(--primary);
}

.class-filter-btn.active {
  background: var(--gradient-primary);
  color: var(--white);
  border-color: var(--primary);
}

.search-results-info {
  text-align: center;
  margin-top: 20px;
  padding: 15px;
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
  border-radius: var(--radius);
  font-weight: 600;
  color: var(--primary);
  border: 2px solid rgba(251, 191, 36, 0.2);
  display: none;
}

/* Classes Section */
.classes-header {
  text-align: center;
  margin: 60px 0 40px;
}

.classes-header h2 {
  font-family: "Playfair Display", serif;
  font-size: 36px;
  color: var(--primary);
  margin-bottom: 15px;
  position: relative;
  display: inline-block;
}

.classes-header h2::after {
  content: "";
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 4px;
  background: var(--gradient-secondary);
  border-radius: 2px;
}

.classes-header p {
  color: var(--gray);
  font-size: 18px;
  max-width: 600px;
  margin: 0 auto;
}

.classes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  gap: 30px;
  margin-bottom: 60px;
}

.class-card {
  background: var(--white);
  border-radius: var(--radius-xl);
  padding: 30px;
  box-shadow: var(--shadow-xl);
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.class-card:hover {
  transform: translateY(-10px);
  box-shadow: var(--shadow-lg);
}

.class-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: var(--gradient-primary);
}

.class-header {
  text-align: center;
  margin-bottom: 30px;
  padding-bottom: 20px;
  border-bottom: 2px solid rgba(30, 58, 138, 0.1);
}

.class-header h3 {
  font-size: 24px;
  color: var(--primary);
  font-weight: 700;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Topper Cards */
.topper-card {
  background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
  border-radius: var(--radius-lg);
  padding: 25px;
  margin-bottom: 25px;
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-shadow: var(--shadow-md);
  transition: all 0.3s ease;
}

.topper-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.topper-card.first {
  border-left: 6px solid var(--gold);
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.05) 0%, rgba(245, 158, 11, 0.02) 100%);
}

.topper-card.second {
  border-left: 6px solid var(--silver);
  background: linear-gradient(135deg, rgba(203, 213, 225, 0.05) 0%, rgba(148, 163, 184, 0.02) 100%);
}

.rank-badge {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  font-size: 20px;
  color: var(--white);
  z-index: 2;
  box-shadow: var(--shadow-md);
  border: 3px solid var(--white);
}

.rank-badge.first {
  background: var(--gradient-secondary);
  color: var(--dark);
}

.rank-badge.second {
  background: linear-gradient(135deg, #64748b 0%, #475569 100%);
}

/* Photo Container */
.photo-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 25px;
}

.photo-container {
  width: 180px;
  height: 180px;
  margin: 0 auto 20px;
  position: relative;
}

.photo-frame {
  width: 100%;
  height: 100%;
  position: relative;
  border-radius: 50%;
  padding: 8px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
  box-shadow: var(--shadow-lg);
}

.topper-card.first .photo-frame {
  background: var(--gradient-secondary);
}

.topper-card.second .photo-frame {
  background: linear-gradient(135deg, #64748b 0%, #475569 100%);
}

.photo {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  overflow: hidden;
  background: var(--white);
  position: relative;
  z-index: 2;
  border: 4px solid var(--white);
}

.photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.upload-btn {
  display: block;
  margin: 20px auto;
  padding: 12px 28px;
  background: var(--gradient-primary);
  color: var(--white);
  border: none;
  border-radius: 50px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-md);
  display: flex;
  align-items: center;
  gap: 8px;
}

.upload-btn:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.student-name {
  text-align: center;
  font-family: "Playfair Display", serif;
  font-size: 24px;
  font-weight: 700;
  color: var(--primary);
  margin: 15px 0 10px;
  position: relative;
  padding-bottom: 12px;
}

.student-name::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  border-radius: 2px;
}

.rank-label {
  text-align: center;
  font-weight: 700;
  margin-top: 10px;
  font-size: 16px;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 8px 20px;
  border-radius: 50px;
  display: inline-block;
  box-shadow: var(--shadow-sm);
}

.rank-label.first {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
  color: #92400e;
  border: 1px solid rgba(251, 191, 36, 0.3);
}

.rank-label.second {
  background: linear-gradient(135deg, rgba(148, 163, 184, 0.15) 0%, rgba(100, 116, 139, 0.1) 100%);
  color: #475569;
  border: 1px solid rgba(148, 163, 184, 0.3);
}

.student-meta {
  text-align: center;
  color: var(--accent);
  font-weight: 600;
  margin-top: 15px;
  font-size: 18px;
  padding: 12px 24px;
  background: rgba(5, 150, 105, 0.08);
  border-radius: 50px;
  display: inline-block;
  border: 1px solid rgba(5, 150, 105, 0.2);
}

/* Action Buttons */
.action-buttons {
  display: flex;
  justify-content: center;
  margin-top: 25px;
}

.preview-btn {
  padding: 16px 40px;
  border-radius: var(--radius);
  border: none;
  cursor: pointer;
  font-weight: 700;
  font-size: 16px;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  width: 100%;
  background: var(--gradient-primary);
  color: var(--white);
  box-shadow: var(--shadow-md);
  position: relative;
  overflow: hidden;
}

.preview-btn:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.preview-btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.6s ease;
}

.preview-btn:hover::after {
  left: 100%;
}

/* Clear All Button */
.clear-all-container {
  text-align: center;
  margin: 40px 0 60px;
}

#clearAllBtn {
  padding: 18px 40px;
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  color: var(--white);
  border: none;
  border-radius: 50px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-md);
  display: inline-flex;
  align-items: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
}

#clearAllBtn:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

#clearAllBtn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

#clearAllBtn:hover::after {
  left: 100%;
}

/* Footer */
.footer {
  text-align: center;
  color: var(--gray);
  margin-top: 60px;
  padding: 40px 30px;
  background: var(--white);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  border-top: 4px solid var(--primary);
}

.footer-content {
  max-width: 600px;
  margin: 0 auto;
}

.footer h3 {
  font-family: "Playfair Display", serif;
  font-size: 24px;
  color: var(--primary);
  margin-bottom: 20px;
}

.footer p {
  margin: 10px 0;
  font-size: 16px;
}

.cert-count {
  font-weight: 800;
  color: var(--primary);
  font-size: 24px;
  display: inline-block;
  margin: 0 5px;
}

.heart {
  color: #ef4444;
  animation: heartbeat 1.5s infinite;
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Loading Overlay */
.loading {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 23, 42, 0.9);
  z-index: 9999;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  color: var(--white);
  backdrop-filter: blur(5px);
}

.loading-spinner {
  width: 70px;
  height: 70px;
  border: 5px solid rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  border-top-color: var(--secondary);
  animation: spin 1s linear infinite;
  margin-bottom: 25px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

#loadingText {
  font-size: 18px;
  font-weight: 500;
  letter-spacing: 1px;
}

/* Certificate Preview Modal */
#certificatePreview {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 23, 42, 0.95);
  z-index: 10000;
  overflow: auto;
  padding: 30px;
  backdrop-filter: blur(10px);
}

.certificate-canvas {
  background: var(--white);
  width: 900px;
  max-width: 95%;
  margin: 40px auto;
  border-radius: 20px;
  box-shadow: var(--shadow-xl);
  position: relative;
}

.close-preview {
  position: fixed;
  top: 30px;
  right: 40px;
  font-size: 40px;
  color: var(--white);
  cursor: pointer;
  background: rgba(255, 255, 255, 0.1);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.close-preview:hover {
  background: rgba(239, 68, 68, 0.8);
  transform: rotate(90deg);
}

/* Preview buttons */
.preview-buttons {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 20px;
  z-index: 10001;
  flex-wrap: wrap;
  justify-content: center;
}

.preview-buttons button {
  padding: 16px 32px;
  border: none;
  border-radius: 12px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
  font-size: 16px;
  box-shadow: var(--shadow-lg);
}

.preview-buttons button:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-xl);
}

/* Photo Preview Modal */
#previewModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 23, 42, 0.95);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(10px);
}

#previewModal .close {
  position: absolute;
  top: 30px;
  right: 40px;
  font-size: 40px;
  color: var(--white);
  cursor: pointer;
  background: rgba(255, 255, 255, 0.1);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
  border: 2px solid rgba(255, 255, 255, 0.2);
}

#previewModal .close:hover {
  background: rgba(239, 68, 68, 0.8);
  transform: rotate(90deg);
}

#previewModal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 20px;
  box-shadow: var(--shadow-xl);
}

/* Responsive Design */
@media (max-width: 1200px) {
  .classes-grid {
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  }
}

@media (max-width: 768px) {
  .wrap {
    padding: 10px;
  }
  
  .header {
    padding: 30px 20px;
    margin-bottom: 40px;
  }
  
  .header h1 {
    font-size: 32px;
  }
  
  .subtitle {
    font-size: 18px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }
  
  .search-container {
    padding: 30px 20px;
  }
  
  .search-box {
    flex-direction: column;
  }
  
  .search-input-wrapper {
    min-width: 100%;
  }
  
  .classes-grid {
    grid-template-columns: 1fr;
    gap: 25px;
  }
  
  .class-card {
    padding: 25px;
  }
  
  .photo-container {
    width: 160px;
    height: 160px;
  }
  
  .footer {
    padding: 30px 20px;
  }
}

@media (max-width: 480px) {
  .header h1 {
    font-size: 28px;
  }
  
  .stat-number {
    font-size: 36px;
  }
  
  .classes-header h2 {
    font-size: 28px;
  }
  
  .guide-list {
    grid-template-columns: 1fr;
  }
  
  .photo-container {
    width: 140px;
    height: 140px;
  }
  
  .student-name {
    font-size: 22px;
  }
  
  .preview-buttons {
    flex-direction: column;
    width: 90%;
  }
  
  .preview-buttons button {
    width: 100%;
    justify-content: center;
  }
}

/* Floating Elements */
.floating-elements {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1;
}

.floating-element {
  position: absolute;
  background: rgba(30, 58, 138, 0.03);
  border-radius: 50%;
  animation: float 20s infinite linear;
}

@keyframes float {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(20px, 20px) rotate(90deg); }
  50% { transform: translate(0, 40px) rotate(180deg); }
  75% { transform: translate(-20px, 20px) rotate(270deg); }
}

/* Success Animation */
.success-animation {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10003;
  display: none;
}

.success-checkmark {
  width: 80px;
  height: 80px;
  margin: 0 auto;
  border-radius: 50%;
  display: block;
  stroke-width: 2;
  stroke: var(--white);
  stroke-miterlimit: 10;
  box-shadow: inset 0px 0px 0px var(--accent);
  animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
  background: var(--gradient-accent);
}

.checkmark__circle {
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 2;
  stroke-miterlimit: 10;
  stroke: var(--white);
  fill: none;
  animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

.checkmark__check {
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
}

@keyframes stroke {
  100% { stroke-dashoffset: 0; }
}

@keyframes scale {
  0%, 100% { transform: none; }
  50% { transform: scale3d(1.1, 1.1, 1); }
}

@keyframes fill {
  100% { box-shadow: inset 0px 0px 0px 100px var(--accent); }
}
</style>
</head>
<body>

<!-- Floating Elements -->
<div class="floating-elements">
  <div class="floating-element" style="width: 100px; height: 100px; top: 10%; left: 5%;"></div>
  <div class="floating-element" style="width: 150px; height: 150px; top: 60%; right: 5%;"></div>
  <div class="floating-element" style="width: 80px; height: 80px; bottom: 20%; left: 15%;"></div>
</div>

<div class="wrap">
  <!-- Header Section -->
  <header class="header">
    <div class="header-content">
      <div class="logo-container">
        <div class="logo-icon">
          <i class="fas fa-award"></i>
        </div>
        <div>
          <h1>NOORUSSALAM MADRASA</h1>
          <p class="subtitle">Annual Examination Results 2025-2026</p>
          <p class="tagline">Celebrating Excellence in Education</p>
        </div>
      </div>
      
      <!-- Stats Section -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">10</div>
          <div class="stat-label">Classes</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">20</div>
          <div class="stat-label">Top Students</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">100%</div>
          <div class="stat-label">Success Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="certCount">0</div>
          <div class="stat-label">Certificates Generated</div>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Guide Section -->
  <div class="guide-card">
    <h3><i class="fas fa-star"></i> Quick Guide to Generate Certificates</h3>
    <ul class="guide-list">
      <li class="guide-item">
        <div class="guide-icon">
          <i class="fas fa-camera"></i>
        </div>
        <span class="guide-text">Upload high-quality student photos</span>
      </li>
      <li class="guide-item">
        <div class="guide-icon">
          <i class="fas fa-search"></i>
        </div>
        <span class="guide-text">Search classes or students quickly</span>
      </li>
      <li class="guide-item">
        <div class="guide-icon">
          <i class="fas fa-eye"></i>
        </div>
        <span class="guide-text">Preview certificates before downloading</span>
      </li>
      <li class="guide-item">
        <div class="guide-icon">
          <i class="fas fa-download"></i>
        </div>
        <span class="guide-text">Download in PNG or PDF format</span>
      </li>
    </ul>
  </div>
  
  <!-- Search Section -->
  <div class="search-container">
    <div class="search-header">
      <h3>Find Students & Classes</h3>
      <p>Search by class number or student name to filter results</p>
    </div>
    
    <div class="search-box">
      <div class="search-input-wrapper">
        <i class="fas fa-search"></i>
        <input type="text" id="classSearch" placeholder="Type class number (1-10) or student name..." autocomplete="off">
      </div>
      <button class="search-btn" onclick="searchClasses()">
        <i class="fas fa-search"></i> Search
      </button>
      <button class="clear-search-btn" onclick="clearSearch()">
        <i class="fas fa-times"></i> Clear
      </button>
    </div>
    
    <div class="class-filters" id="classFilterButtons">
      <!-- Class filter buttons will be generated by JavaScript -->
    </div>
    
    <div class="search-results-info" id="searchResultsInfo">
      <!-- Search results info will be shown here -->
    </div>
  </div>
  
  <!-- Classes Section -->
  <div class="classes-header">
    <h2>Class Toppers & Achievers</h2>
    <p>Select a class to view top performers and generate certificates</p>
  </div>
  
  <div id="grid" class="classes-grid"></div>
  
  <!-- Clear All Button -->
  <div class="clear-all-container">
    <button id="clearAllBtn" onclick="clearAllPhotos()">
      <i class="fas fa-broom"></i> Clear All Uploaded Photos
    </button>
  </div>
  
  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <h3>Noorussalam Madrasa</h3>
      <p>Kambippalam-Kerala Estate â€¢ Academic Year 2025-2026</p>
      <p>Certificates Generated: <span class="cert-count" id="certCountFooter">0</span></p>
      <p>Designed with <i class="fas fa-heart heart"></i> to celebrate student achievements</p>
      <p style="margin-top: 20px; font-size: 14px; color: #94a3b8;">Â© 2025-2026 All Rights Reserved</p>
    </div>
  </footer>
</div>

<!-- Loading Overlay -->
<div class="loading" id="loading">
  <div class="loading-spinner"></div>
  <p id="loadingText">Generating Beautiful Certificate...</p>
</div>

<!-- Certificate Preview Modal -->
<div id="certificatePreview">
  <div class="close-preview" onclick="closeCertificatePreview()">Ã—</div>
  <canvas id="previewCanvas" class="certificate-canvas"></canvas>
</div>

<!-- Photo Preview Modal -->
<div id="previewModal">
  <span class="close" onclick="closePreview()">Ã—</span>
  <img id="previewImage" src="" alt="Photo Preview">
</div>

<!-- Success Animation -->
<div class="success-animation" id="successAnimation">
  <svg class="success-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
  </svg>
</div>

<!-- Sound -->
<audio id="certSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

<script>
// Certificate background image URL
const CERT_BG = "https://i.ibb.co/M5ZH2Svc/NSM-TOPPER-copy.jpg";

// Class data with two toppers per class (First and Second)
const classesData = [
  { 
    class: "1", 
    toppers: [
      { name: "Suhail P", mark: "498 / 500", rank: "First" },
      { name: "Minhaj P", mark: "495 / 500", rank: "Second" }
    ]
  },
  { 
    class: "2", 
    toppers: [
      { name: "Muhammed Shahid", mark: "493 / 500", rank: "First" },
      { name: "Ashmil T", mark: "490 / 500", rank: "Second" }
    ]
  },
  { 
    class: "3", 
    toppers: [
      { name: "Muhammed Hadi K", mark: "487 / 500", rank: "First" },
      { name: "Danish T", mark: "485 / 500", rank: "Second" }
    ]
  },
  { 
    class: "4", 
    toppers: [
      { name: "Faris P", mark: "489 / 500", rank: "First" },
      { name: "Rifaee P", mark: "486 / 500", rank: "Second" }
    ]
  },
  { 
    class: "5", 
    toppers: [
      { name: "Shamil N", mark: "491 / 500", rank: "First" },
      { name: "Nida Mol", mark: "488 / 500", rank: "Second" }
    ]
  },
  { 
    class: "6", 
    toppers: [
      { name: "Hana M", mark: "480 / 500", rank: "First" },
      { name: "Riya T", mark: "478 / 500", rank: "Second" }
    ]
  },
  { 
    class: "7", 
    toppers: [
      { name: "Riyas M", mark: "485 / 500", rank: "First" },
      { name: "Riya Mol", mark: "482 / 500", rank: "Second" }
    ]
  },
  { 
    class: "8", 
    toppers: [
      { name: "Zainab K", mark: "492 / 500", rank: "First" },
      { name: "Muhsin P", mark: "489 / 500", rank: "Second" }
    ]
  },
  { 
    class: "9", 
    toppers: [
      { name: "Thaj T", mark: "488 / 500", rank: "First" },
      { name: "Sinan P", mark: "485 / 500", rank: "Second" }
    ]
  },
  { 
    class: "10", 
    toppers: [
      { name: "Saniya F", mark: "495 / 500", rank: "First" },
      { name: "Asna K", mark: "492 / 500", rank: "Second" }
    ]
  }
];

// Initialize uploaded photos array from localStorage
const uploadedPhotos = {};
classesData.forEach((cls, classIndex) => {
  uploadedPhotos[classIndex] = [];
  cls.toppers.forEach((topper, topperIndex) => {
    const saved = localStorage.getItem(`topperPhoto_${classIndex}_${topperIndex}`);
    uploadedPhotos[classIndex][topperIndex] = saved || null;
  });
});

// Track certificate generation count
let certCount = parseInt(localStorage.getItem('certCount') || '0');
updateCertCount();

// Track active search
let activeSearch = '';

// Helper functions
function escapeHtml(s){ 
  return String(s || "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); 
}

function placeholderDataURL(){ 
  const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">
    <defs>
      <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#f0f9ff"/>
        <stop offset="100%" stop-color="#e0f2fe"/>
      </linearGradient>
      <linearGradient id="circle" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#1e3a8a"/>
        <stop offset="100%" stop-color="#3b82f6"/>
      </linearGradient>
    </defs>
    <rect width="500" height="500" fill="url(#bg)" rx="250"/>
    <circle cx="250" cy="200" r="120" fill="url(#circle)" opacity="0.1"/>
    <circle cx="250" cy="200" r="100" fill="#f8fafc" stroke="#3b82f6" stroke-width="2"/>
    <g fill="#1e3a8a" font-family="Arial" text-anchor="middle">
      <text x="250" y="190" font-size="28" font-weight="bold">Student</text>
      <text x="250" y="230" font-size="22" font-weight="bold">Photo</text>
      <text x="250" y="350" font-size="18">Click "Upload Photo"</text>
      <text x="250" y="380" font-size="16">to add student image</text>
    </g>
  </svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

function updateCertCount() {
  const countElement = document.getElementById('certCount');
  const footerCountElement = document.getElementById('certCountFooter');
  if (countElement) countElement.textContent = certCount;
  if (footerCountElement) footerCountElement.textContent = certCount;
}

// Show notification with beautiful style
function showNotification(message, type = 'info') {
  const icon = {
    success: 'check-circle',
    error: 'exclamation-circle',
    info: 'info-circle',
    warning: 'exclamation-triangle'
  }[type];
  
  const color = {
    success: '#10b981',
    error: '#ef4444',
    info: '#3b82f6',
    warning: '#f59e0b'
  }[type];
  
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 30px;
    right: 30px;
    background: ${color};
    color: white;
    padding: 20px 25px;
    border-radius: 16px;
    font-weight: 500;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    z-index: 10000;
    transform: translateX(150%);
    transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    display: flex;
    align-items: center;
    gap: 15px;
    max-width: 400px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  `;
  notification.innerHTML = `
    <div style="font-size: 24px;">
      <i class="fas fa-${icon}"></i>
    </div>
    <div>
      <div style="font-weight: 600; margin-bottom: 5px;">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
      <div>${message}</div>
    </div>
  `;
  document.body.appendChild(notification);
  
  setTimeout(() => notification.style.transform = 'translateX(0)', 10);
  
  setTimeout(() => {
    notification.style.transform = 'translateX(150%)';
    setTimeout(() => notification.remove(), 500);
  }, 3000);
}

// Show success animation
function showSuccessAnimation() {
  const animation = document.getElementById('successAnimation');
  animation.style.display = 'block';
  setTimeout(() => {
    animation.style.display = 'none';
  }, 2000);
}

// Create class filter buttons
function createClassFilterButtons() {
  const container = document.getElementById('classFilterButtons');
  container.innerHTML = '';
  
  // Add "All Classes" button
  const allButton = document.createElement('button');
  allButton.className = 'class-filter-btn active';
  allButton.innerHTML = '<i class="fas fa-layer-group"></i> All Classes';
  allButton.onclick = () => filterByClass('all');
  container.appendChild(allButton);
  
  // Add buttons for each class
  classesData.forEach(cls => {
    const button = document.createElement('button');
    button.className = 'class-filter-btn';
    button.innerHTML = `<i class="fas fa-graduation-cap"></i> Class ${cls.class}`;
    button.onclick = () => filterByClass(cls.class);
    container.appendChild(button);
  });
}

// Filter classes by class number
function filterByClass(classNumber) {
  activeSearch = classNumber === 'all' ? '' : classNumber;
  
  // Update active button
  document.querySelectorAll('.class-filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Find and activate the clicked button
  const buttons = document.querySelectorAll('.class-filter-btn');
  if (classNumber === 'all') {
    buttons[0].classList.add('active');
  } else {
    buttons[classNumber].classList.add('active');
  }
  
  // Update search input
  document.getElementById('classSearch').value = classNumber === 'all' ? '' : classNumber;
  
  // Apply filter
  applySearchFilter();
}

// Search classes
function searchClasses() {
  const searchTerm = document.getElementById('classSearch').value.trim().toLowerCase();
  
  if (!searchTerm) {
    clearSearch();
    return;
  }
  
  activeSearch = searchTerm;
  applySearchFilter();
  
  // Update filter buttons
  document.querySelectorAll('.class-filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // If searching by class number, activate that button
  if (/^[1-9]|10$/.test(searchTerm)) {
    const buttons = document.querySelectorAll('.class-filter-btn');
    const classNum = parseInt(searchTerm);
    if (classNum >= 1 && classNum <= 10) {
      buttons[classNum].classList.add('active');
    }
  }
}

// Apply search filter
function applySearchFilter() {
  const searchTerm = activeSearch.toLowerCase();
  const classCards = document.querySelectorAll('.class-card');
  let visibleCount = 0;
  
  classCards.forEach(card => {
    const classNumber = card.querySelector('.class-header h3').textContent.replace('Class ', '');
    const studentNames = Array.from(card.querySelectorAll('.student-name')).map(el => el.textContent.toLowerCase());
    
    let shouldShow = false;
    
    if (!searchTerm) {
      shouldShow = true;
    } else if (/^[1-9]|10$/.test(searchTerm)) {
      shouldShow = classNumber === searchTerm;
    } else {
      shouldShow = studentNames.some(name => name.includes(searchTerm));
    }
    
    if (shouldShow) {
      card.classList.remove('hidden');
      visibleCount++;
    } else {
      card.classList.add('hidden');
    }
  });
  
  // Update search results info
  const resultsInfo = document.getElementById('searchResultsInfo');
  if (searchTerm) {
    if (visibleCount === 0) {
      resultsInfo.innerHTML = `<i class="fas fa-info-circle"></i> No classes or students found for "${searchTerm}"`;
      resultsInfo.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%)';
      resultsInfo.style.borderColor = 'rgba(239, 68, 68, 0.2)';
    } else {
      resultsInfo.innerHTML = `<i class="fas fa-check-circle"></i> Showing ${visibleCount} class${visibleCount !== 1 ? 'es' : ''} for "${searchTerm}"`;
      resultsInfo.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%)';
      resultsInfo.style.borderColor = 'rgba(16, 185, 129, 0.2)';
    }
    resultsInfo.style.display = 'block';
  } else {
    resultsInfo.style.display = 'none';
  }
  
  // Scroll to first visible card
  if (visibleCount > 0) {
    const firstVisible = document.querySelector('.class-card:not(.hidden)');
    if (firstVisible) {
      firstVisible.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
}

// Clear search
function clearSearch() {
  document.getElementById('classSearch').value = '';
  activeSearch = '';
  
  document.querySelectorAll('.class-filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  document.querySelectorAll('.class-filter-btn')[0].classList.add('active');
  
  document.getElementById('searchResultsInfo').style.display = 'none';
  
  document.querySelectorAll('.class-card').forEach(card => {
    card.classList.remove('hidden');
  });
  
  document.getElementById('classSearch').focus();
}

// Load class cards
const grid = document.getElementById('grid');
function loadClassCards() {
  grid.innerHTML = '';
  
  classesData.forEach((cls, classIndex) => {
    const card = document.createElement('div');
    card.className = 'class-card';
    
    let toppersHTML = '';
    cls.toppers.forEach((topper, topperIndex) => {
      const photoURL = uploadedPhotos[classIndex][topperIndex] || placeholderDataURL();
      const isFirst = topper.rank === 'First';
      
      toppersHTML += `
        <div class="topper-card ${isFirst ? 'first' : 'second'}">
          <div class="rank-badge ${isFirst ? 'first' : 'second'}">
            ${isFirst ? '1st' : '2nd'}
          </div>
          <div class="photo-display">
            <div class="photo-container">
              <div class="photo-frame">
                <div class="photo">
                  <img src="${photoURL}" alt="${escapeHtml(topper.name)}" 
                       onclick="previewPhoto('${photoURL.replace(/'/g, "\\'")}')"
                       aria-label="Photo of ${escapeHtml(topper.name)}">
                </div>
              </div>
            </div>
            <button class="upload-btn" onclick="document.getElementById('file-${classIndex}-${topperIndex}').click()">
              <i class="fas fa-cloud-upload-alt"></i> Upload Photo
            </button>
            <input type="file" id="file-${classIndex}-${topperIndex}" accept="image/*" style="display:none" 
                   onchange="handlePhotoUpload(this, ${classIndex}, ${topperIndex})">
          </div>
          <div class="student-name">${escapeHtml(topper.name)}</div>
          <div class="rank-label ${isFirst ? 'first' : 'second'}">${topper.rank} Place in Class</div>
          <div class="student-meta">Marks: ${escapeHtml(topper.mark)}</div>
          <div class="action-buttons">
            <button class="preview-btn" onclick="previewCertificate('${topper.name}','${cls.class}','${topper.mark}', '${topper.rank}', uploadedPhotos[${classIndex}][${topperIndex}] || '${photoURL}')">
              <i class="fas fa-certificate"></i> Preview Certificate
            </button>
          </div>
        </div>
      `;
    });
    
    card.innerHTML = `
      <div class="class-header">
        <h3>Class ${escapeHtml(cls.class)}</h3>
      </div>
      ${toppersHTML}
    `;
    
    grid.appendChild(card);
  });
}

// Validate photo
function validatePhoto(file) {
  const maxSize = 10 * 1024 * 1024;
  const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
  
  if (!allowedTypes.includes(file.type)) {
    showNotification('Please upload JPG, PNG, GIF, or WebP images only.', 'error');
    return false;
  }
  
  if (file.size > maxSize) {
    showNotification('Image size should be less than 10MB.', 'error');
    return false;
  }
  
  return true;
}

// Handle photo upload
async function handlePhotoUpload(input, classIndex, topperIndex) {
  const file = input.files[0]; 
  if(!file) return;
  
  if(!validatePhoto(file)) return;
  
  const reader = new FileReader();
  reader.onload = async function(e) {
    try {
      uploadedPhotos[classIndex][topperIndex] = e.target.result;
      localStorage.setItem(`topperPhoto_${classIndex}_${topperIndex}`, e.target.result);
      
      const img = input.closest('.photo-frame').querySelector('img');
      if(img) img.src = e.target.result;
      
      showNotification('Photo uploaded successfully! ðŸŽ‰', 'success');
      showSuccessAnimation();
      
      // Add subtle animation to the photo
      const photoFrame = input.closest('.photo-frame');
      photoFrame.style.transform = 'scale(1.1)';
      setTimeout(() => {
        photoFrame.style.transform = 'scale(1)';
      }, 300);
      
    } catch(error) {
      console.error('Error uploading image:', error);
      showNotification('Error uploading photo. Please try again.', 'error');
    }
  };
  
  reader.onerror = function() {
    showNotification('Error uploading photo. Please try again.', 'error');
  };
  
  reader.readAsDataURL(file);
}

// Preview photo in modal
function previewPhoto(src) {
  if(src.includes('Student</text>')) return;
  document.getElementById('previewImage').src = src;
  document.getElementById('previewModal').style.display = 'flex';
}

// Close photo preview modal
function closePreview() {
  document.getElementById('previewModal').style.display = 'none';
}

// Show loading
function showLoading(text = 'Generating Beautiful Certificate...') {
  document.getElementById('loadingText').textContent = text;
  document.getElementById('loading').style.display = 'flex';
}

// Hide loading
function hideLoading() {
  document.getElementById('loading').style.display = 'none';
}

// Load image helper
function loadImage(src) { 
  return new Promise((resolve, reject) => { 
    const img = new Image(); 
    img.crossOrigin = "anonymous"; 
    img.onload = () => resolve(img); 
    img.onerror = () => reject(new Error(`Failed to load image: ${src}`)); 
    img.src = src; 
  }); 
}

// Function to draw soft ribbon patterns in background
function drawSoftRibbons(ctx, w, h) {
  ctx.save();
  ctx.globalAlpha = 0.03;
  
  const ribbonColors = ['#1e3a8a', '#fbbf24', '#059669', '#9333ea'];
  
  for (let i = 0; i < 8; i++) {
    const color = ribbonColors[i % ribbonColors.length];
    const y = (h / 8) * i + 100;
    
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(-100, y);
    ctx.bezierCurveTo(w/4, y - 50, w/2, y + 50, w + 100, y);
    ctx.bezierCurveTo(w/2, y + 150, w/4, y + 50, -100, y + 100);
    ctx.closePath();
    ctx.fill();
  }
  
  ctx.restore();
}

// Render certificate canvas WITHOUT photo border
async function renderCertificateCanvas(name, cls, mark, rank, photo) {
  const w = 1200, h = 1600;
  const canvas = document.createElement("canvas"); 
  canvas.width = w; 
  canvas.height = h;
  const ctx = canvas.getContext("2d");
  
  try {
    const bg = await loadImage(CERT_BG); 
    ctx.drawImage(bg, 0, 0, w, h);
    
    drawSoftRibbons(ctx, w, h);
    
    const cx = w/2, cy = 800, r = 200;
    
    if(photo && !photo.includes('Student</text>')) {
      try {
        const img = await loadImage(photo);
        ctx.save(); 
        ctx.beginPath(); 
        ctx.arc(cx, cy, r, 0, Math.PI * 2); 
        ctx.clip();
        
        const scale = Math.max(r * 2 / img.width, r * 2 / img.height);
        const x = cx - (img.width * scale) / 2;
        const y = cy - (img.height * scale) / 2;
        
        ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
        ctx.shadowBlur = 10;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 3;
        
        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
        ctx.restore();
        
        ctx.shadowBlur = 0;
        ctx.shadowColor = 'transparent';
        
      } catch(e) {
        console.error("Error loading student photo:", e);
        drawPlaceholderPhoto(ctx, cx, cy, r, name, rank);
      }
    } else {
      drawPlaceholderPhoto(ctx, cx, cy, r, name, rank);
    }
    
    ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
    ctx.shadowBlur = 8;
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 4;
    
    ctx.fillStyle = '#0f172a';
    ctx.font = 'bold 56px "Playfair Display"';
    ctx.textAlign = 'center';
    ctx.fillText(name, cx, 1080);
    
    ctx.fillStyle = '#1e3a8a';
    ctx.font = 'bold 36px "Poppins"';
    ctx.fillText(`Class: ${cls} | Marks: ${mark}`, cx, 1150);
    
    const rankColor = rank === 'First' ? '#d4af37' : '#64748b';
    ctx.fillStyle = rankColor;
    ctx.font = 'bold 38px "Poppins"';
    const rankText = rank === 'First' ? 'CLASS TOPPER' : 'second place in class';
    ctx.fillText(rankText, cx, 1210);
    
    ctx.beginPath();
    ctx.moveTo(cx - 200, 1220);
    ctx.lineTo(cx + 200, 1220);
    ctx.lineWidth = 3;
    ctx.strokeStyle = rankColor;
    ctx.setLineDash([10, 5]);
    ctx.stroke();
    ctx.setLineDash([]);
    
    ctx.shadowBlur = 0;
    ctx.shadowColor = 'transparent';
    
    return canvas;
  } catch(error) {
    console.error("Error rendering certificate:", error);
    throw new Error("Failed to load certificate background");
  }
}

// Draw placeholder photo WITHOUT border
function drawPlaceholderPhoto(ctx, cx, cy, r, name, rank) {
  const solidColor = rank === 'First' ? '#fffbeb' : '#f8fafc';
  
  ctx.fillStyle = solidColor;
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.fill();
  
  ctx.fillStyle = rank === 'First' ? '#d4af37' : '#64748b';
  ctx.font = 'bold 48px "Font Awesome 6 Free"';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('ðŸ‘¨â€ðŸŽ“', cx, cy);
}

// Preview certificate
async function previewCertificate(name, cls, mark, rank, photo) {
  try {
    showLoading();
    const canvas = await renderCertificateCanvas(name, cls, mark, rank, photo);
    hideLoading();
    
    const previewCanvas = document.getElementById('previewCanvas');
    const ctx = previewCanvas.getContext('2d');
    
    previewCanvas.width = 800;
    previewCanvas.height = 1067;
    
    ctx.drawImage(canvas, 0, 0, 1200, 1600, 0, 0, 800, 1067);
    
    document.getElementById('certificatePreview').style.display = 'block';
    
    setTimeout(() => {
      const existingButtons = document.querySelector('.preview-buttons');
      if (existingButtons) existingButtons.remove();
      
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'preview-buttons';
      
      buttonContainer.innerHTML = `
        <button onclick="downloadCertificate('${name}','${cls}','${mark}','${rank}','${photo.replace(/'/g, "\\'")}', 'png')" 
                style="background:linear-gradient(135deg, #fbbf24, #f59e0b); color:#0f172a; border: 2px solid #fbbf24;">
          <i class="fas fa-download"></i> Download PNG
        </button>
        <button onclick="downloadCertificate('${name}','${cls}','${mark}','${rank}','${photo.replace(/'/g, "\\'")}', 'pdf')" 
                style="background:linear-gradient(135deg, #1e3a8a, #3b82f6); color:white; border: 2px solid #3b82f6;">
          <i class="fas fa-file-pdf"></i> Download PDF
        </button>
      `;
      
      document.getElementById('certificatePreview').appendChild(buttonContainer);
    }, 100);
    
  } catch(error) {
    hideLoading();
    console.error("Error previewing certificate:", error);
    showNotification("Error previewing certificate. Please try again.", 'error');
  }
}

// Close certificate preview
function closeCertificatePreview() {
  document.getElementById('certificatePreview').style.display = 'none';
  const buttons = document.querySelector('.preview-buttons');
  if (buttons) buttons.remove();
}

// Download certificate
async function downloadCertificate(name, cls, mark, rank, photo, type) {
  try {
    showLoading();
    
    const sound = document.getElementById("certSound"); 
    sound.currentTime = 0; 
    sound.play().catch(e => console.log("Audio play failed:", e));
    
    const canvas = await renderCertificateCanvas(name, cls, mark, rank, photo);
    const img = canvas.toDataURL("image/png");
    
    // Enhanced confetti
    confetti({
      particleCount: 200,
      spread: 150,
      origin: { y: 0.6 },
      colors: rank === 'First' ? ['#fbbf24', '#f59e0b', '#d97706', '#ffffff'] : ['#c0c0c0', '#94a3b8', '#64748b', '#ffffff']
    });
    
    setTimeout(() => {
      confetti({
        particleCount: 100,
        angle: 60,
        spread: 80,
        origin: { x: 0 },
        colors: rank === 'First' ? ['#fbbf24', '#f59e0b'] : ['#c0c0c0', '#94a3b8']
      });
    }, 250);
    
    setTimeout(() => {
      confetti({
        particleCount: 100,
        angle: 120,
        spread: 80,
        origin: { x: 1 },
        colors: rank === 'First' ? ['#fbbf24', '#f59e0b'] : ['#c0c0c0', '#94a3b8']
      });
    }, 500);
    
    certCount++;
    localStorage.setItem('certCount', certCount);
    updateCertCount();
    
    const fileName = `Noorussalam_Class${cls}_${rank.replace(' ', '_')}_${name.replace(/\s+/g, '_')}`;
    
    if(type === "png") {
      const a = document.createElement("a"); 
      a.href = img; 
      a.download = `${fileName}.png`; 
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      showNotification(`ðŸŽ‰ Certificate for ${name} downloaded successfully!`, 'success');
      showSuccessAnimation();
    } else if(type === "pdf") {
      const { jsPDF } = window.jspdf; 
      const pdf = new jsPDF({orientation: "portrait", unit: "px", format: [1200, 1600]});
      pdf.addImage(img, "PNG", 0, 0, 1200, 1600); 
      pdf.save(`${fileName}.pdf`);
      showNotification(`ðŸ“„ PDF certificate for ${name} downloaded!`, 'success');
      showSuccessAnimation();
    }
    
    hideLoading();
    
  } catch(error) {
    hideLoading();
    console.error("Error generating certificate:", error);
    showNotification("Error generating certificate. Please try again.", 'error');
  }
}

// Clear all uploaded photos
function clearAllPhotos() {
  if(confirm("Are you sure you want to clear all uploaded photos? This action cannot be undone.")) {
    classesData.forEach((cls, classIndex) => {
      cls.toppers.forEach((topper, topperIndex) => {
        localStorage.removeItem(`topperPhoto_${classIndex}_${topperIndex}`);
        uploadedPhotos[classIndex][topperIndex] = null;
        
        const img = document.querySelector(`#file-${classIndex}-${topperIndex}`)?.closest('.photo-frame')?.querySelector('img');
        if(img) img.src = placeholderDataURL();
      });
    });
    showNotification('All photos cleared successfully!', 'success');
  }
}

// Close modal when clicking outside
document.getElementById('previewModal').addEventListener('click', function(e) {
  if(e.target === this) closePreview();
});

document.getElementById('certificatePreview').addEventListener('click', function(e) {
  if(e.target === this) closeCertificatePreview();
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape') {
    closePreview();
    closeCertificatePreview();
  } else if (e.key === 'Enter' && document.getElementById('classSearch').matches(':focus')) {
    e.preventDefault();
    searchClasses();
  } else if (e.key === '/' && !document.getElementById('classSearch').matches(':focus')) {
    e.preventDefault();
    document.getElementById('classSearch').focus();
  }
});

// Initialize when page loads
window.addEventListener('load', function() {
  // Test background image
  const testImg = new Image();
  testImg.onload = function() {
    console.log('Certificate background loaded successfully');
  };
  testImg.onerror = function() {
    showNotification('Note: Using enhanced certificate design', 'info');
  };
  testImg.src = CERT_BG;
  
  // Load class cards
  loadClassCards();
  
  // Create class filter buttons
  createClassFilterButtons();
  
  // Focus on search input
  setTimeout(() => {
    document.getElementById('classSearch').focus();
  }, 500);
  
  // Add floating elements dynamically
  const floatingContainer = document.querySelector('.floating-elements');
  for (let i = 0; i < 5; i++) {
    const element = document.createElement('div');
    element.className = 'floating-element';
    const size = Math.random() * 60 + 40;
    const top = Math.random() * 80 + 10;
    const left = Math.random() * 80 + 10;
    const delay = Math.random() * 20;
    element.style.cssText = `
      width: ${size}px;
      height: ${size}px;
      top: ${top}%;
      left: ${left}%;
      background: rgba(${i % 2 ? '30, 58, 138' : '251, 191, 36'}, 0.03);
      animation-delay: ${delay}s;
    `;
    floatingContainer.appendChild(element);
  }
});
</script>
</body>
</html>
