<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Class Topper Certificate Generator — Noorussalam Madrasa</title>

<!-- Fonts & icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Amiri&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --accent:#0d6efd;
  --gold:#ffd700;
  --card-radius:14px;
  --max-width:1100px;
  --bg1:#eef9ff;
}
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:var(--bg1);
  color:#073045;
  padding:20px;
}
.wrap{max-width:1100px;margin:0 auto 60px;}
header{text-align:center;margin-bottom:14px}
header h1{color:#073045;margin:6px 0;font-size:28px;font-weight:700}
header p{margin:0;color:#0b3b50;opacity:.85}

.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
@media(max-width:820px){ .grid{grid-template-columns:1fr} }

.card{
  background:#fff;border-radius:var(--card-radius);padding:14px;box-shadow:0 8px 20px rgba(2,6,23,0.06);
  border:2px solid rgba(255,215,0,0.25);position:relative;
  overflow:hidden;
}
.medal{
  width:56px;height:56px;border-radius:50%;background:var(--gold);display:flex;align-items:center;justify-content:center;font-weight:900;color:#000;margin:6px auto;font-size:20px;
  animation: shine 1.5s infinite alternate;
}
@keyframes shine {
  0%{ transform: scale(1) rotate(0deg); box-shadow:0 0 4px #ffd700; }
  50%{ transform: scale(1.1) rotate(10deg); box-shadow:0 0 12px #ffd700; }
  100%{ transform: scale(1) rotate(-5deg); box-shadow:0 0 6px #ffd700; }
}

.photo{ width:110px;height:110px;border-radius:50%;overflow:hidden;margin:10px auto;border:3px solid var(--accent);background:#f6fbff }
.photo img{ width:100%;height:100%;object-fit:cover;display:block }
.photo-upload{ display:block;margin:8px auto; }
.name{ text-align:center;font-weight:700;margin-top:6px }
.meta{ text-align:center;color:#0a3b45;font-weight:600;margin-top:6px }
.btns{ display:flex;gap:8px;justify-content:center;margin-top:10px;flex-wrap:wrap }
.btn{ padding:9px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700 }
.btn-png{ background:var(--gold); color:#000 }
.btn-pdf{ background:var(--accent);color:#fff }
.btn-print{ background:#10b981;color:#032 }
.controls{ display:flex;gap:8px;align-items:center;justify-content:center;margin:14px 0 }
.small{ font-size:13px;color:#445; }
footer{ text-align:center;color:#345;margin-top:18px;font-size:14px }

.reset-btn{ background:#ef4444;color:#fff;padding:8px 12px;border-radius:8px;border:none }

/* Modal */
#previewModal{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:9999;
}
#previewModal img{max-width:90%;max-height:90%;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,0.4);}
#previewModal .close{position:absolute;top:20px;right:30px;font-size:28px;color:#fff;cursor:pointer;font-weight:700;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>NOORUSSALAM MADRASA</h1>
    <p class="small">Annual Examination — Class Topper • Upload photo & generate certificate</p>
  </header>

  <div class="controls">
    <label class="small"><strong>Certificate Background Loaded from Online Server</strong></label>
    <button class="reset-btn" id="resetAll">Reset All Saved Photos</button>
  </div>

  <div id="grid" class="grid" aria-live="polite"></div>

  <footer>© Noorussalam Madrasa — Auto-date added to certificate</footer>
</div>

<!-- Preview Modal -->
<div id="previewModal">
  <span class="close" onclick="closePreview()">×</span>
  <img id="previewImage" src="">
</div>

<script>
const CERT_BG = "https://i.ibb.co/Fb5bkwrK/CERTIFICATR.jpg";
const SIG_SRC  = "https://i.ibb.co/HfzzG1TN/Whats-App-Image-2025-11-26-at-11-41-41-AM-removebg-preview.png";

const toppers = [
  { class: "1", name: "Ayesha Rahman", mark: "498 / 500" },
  { class: "2", name: "Muhammed Shahid", mark: "493 / 500" },
  { class: "3", name: "Nimra Sameer", mark: "487 / 500" },
  { class: "4", name: "Faris P", mark: "489 / 500" },
  { class: "5", name: "Shamil N", mark: "491 / 500" },
  { class: "6", name: "Hana M", mark: "480 / 500" },
  { class: "7", name: "Riyas M", mark: "485 / 500" },
  { class: "8", name: "Zainab K", mark: "492 / 500" },
  { class: "9", name: "Yusuf T", mark: "488 / 500" },
  { class: "10", name: "Saniya F", mark: "495 / 500" }
];

const uploadedPhotos = Array(toppers.length).fill(null);
for(let i=0;i<toppers.length;i++){
  const saved = localStorage.getItem(`topperPhoto_${i}`);
  if(saved) uploadedPhotos[i] = saved;
}

function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function placeholderDataURL(){ 
  const svg='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><rect width="100%" height="100%" fill="#eef9ff"/><circle cx="200" cy="150" r="90" fill="#cfeeff"/></svg>';
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
}

const grid=document.getElementById('grid');
toppers.forEach((t,i)=>{
  const photoURL=uploadedPhotos[i]||placeholderDataURL();
  const card=document.createElement('div');
  card.className='card';
  card.innerHTML=`
    <div class="medal">${i+1}</div>
    <div class="photo"><img src="${photoURL}" alt="${escapeHtml(t.name)}"></div>
    <input type="file" accept="image/*" class="photo-upload" onchange="handlePhotoUpload(this, ${i})">
    <div class="name">${escapeHtml(t.name)}</div>
    <div class="meta">Class ${escapeHtml(t.class)} • ${escapeHtml(t.mark)}</div>
    <div class="btns">
      <button class="btn btn-png" onclick="previewCertificate('${t.name}','${t.class}','${t.mark}', uploadedPhotos[${i}]||'${photoURL}','png',${i})"><i class="fa fa-file-image"></i> PNG</button>
      <button class="btn btn-pdf" onclick="previewCertificate('${t.name}','${t.class}','${t.mark}', uploadedPhotos[${i}]||'${photoURL}','pdf',${i})"><i class="fa fa-file-pdf"></i> PDF</button>
      <button class="btn btn-print" onclick="previewCertificate('${t.name}','${t.class}','${t.mark}', uploadedPhotos[${i}]||'${photoURL}','print',${i})"><i class="fa fa-print"></i> Print</button>
    </div>
  `;
  grid.appendChild(card);
});

function handlePhotoUpload(input,index){
  const file=input.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    uploadedPhotos[index]=e.target.result;
    localStorage.setItem(`topperPhoto_${index}`,e.target.result);
    input.closest('.card').querySelector('img').src=e.target.result;
  };
  reader.readAsDataURL(file);
}

document.getElementById('resetAll').onclick=()=>{
  if(!confirm("Clear all photos?")) return;
  for(let i=0;i<toppers.length;i++){
    localStorage.removeItem(`topperPhoto_${i}`);
    uploadedPhotos[i]=null;
  }
  location.reload();
};

function loadImage(src){ return new Promise((res,rej)=>{ const img=new Image(); img.crossOrigin="anonymous"; img.onload=()=>res(img); img.onerror=()=>rej(); img.src=src; }); }

function getGradient(ctx, cx, cy, r, index){
  const colors=[
    ["#ff9a9e","#fad0c4"],["#a18cd1","#fbc2eb"],["#fad0c4","#ffd1ff"],["#ffecd2","#fcb69f"],
    ["#ffdde1","#ee9ca7"],["#cfd9df","#e2ebf0"],["#fbc2eb","#a6c1ee"],["#89f7fe","#66a6ff"],
    ["#fdfbfb","#ebedee"],["#a1c4fd","#c2e9fb"]
  ];
  const grad = ctx.createRadialGradient(cx, cy, r*0.3, cx, cy, r*1.1);
  grad.addColorStop(0, colors[index%colors.length][0]);
  grad.addColorStop(1, colors[index%colors.length][1]);
  return grad;
}

async function renderCertificateCanvas(name,cls,mark,photoURL,index){
  const w=1125,h=1500,canvas=document.createElement("canvas");
  canvas.width=w; canvas.height=h;
  const ctx=canvas.getContext("2d");

  const bg=await loadImage(CERT_BG);
  ctx.drawImage(bg,0,0,w,h);

  const centerX=w/2, centerY=h/2;
  const r=210;

  // Gradient behind photo
  ctx.beginPath();
  ctx.arc(centerX,centerY,r*1.1,0,Math.PI*2);
  ctx.fillStyle=getGradient(ctx,centerX,centerY,r,index);
  ctx.fill();

  // Draw photo
  if(photoURL){
    const img=await loadImage(photoURL);
    const temp=document.createElement("canvas");
    temp.width=r*2; temp.height=r*2;
    const tctx=temp.getContext("2d");
    const scale=Math.max(temp.width/img.width,temp.height/img.height);
    tctx.drawImage(img,(temp.width-img.width*scale)/2,(temp.height-img.height*scale)/2,img.width*scale,img.height*scale);
    ctx.save();
    ctx.beginPath(); ctx.arc(centerX,centerY,r,0,Math.PI*2); ctx.clip();
    ctx.drawImage(temp,centerX-r,centerY-r);
    ctx.restore();
  }

  // Medal above photo
  const medalRadius=56;
  ctx.beginPath();
  ctx.arc(centerX,centerY-r-40,medalRadius/2,0,Math.PI*2);
  ctx.fillStyle="#ffd700"; ctx.fill();
  ctx.fillStyle="#000"; ctx.font="bold 28px sans-serif"; ctx.textAlign="center";
  ctx.fillText(`${index+1}`,centerX,centerY-r-35);

  // Photo ring
  ctx.beginPath(); ctx.arc(centerX,centerY,r+12,0,Math.PI*2);
  ctx.strokeStyle="#ffd700"; ctx.lineWidth=18; ctx.stroke();

  // Name & class/marks below photo
  ctx.fillStyle="#073045"; ctx.textAlign="center";
  ctx.font="bold 60px sans-serif"; ctx.fillText(name,centerX,centerY+r+80);
  ctx.font="32px sans-serif"; ctx.fillText(`Class: ${cls} | Marks: ${mark}`,centerX,centerY+r+140);

  // Date bottom left
  const d=new Date();
  const dstr=d.toLocaleDateString("en-IN",{day:"numeric",month:"long",year:"numeric"});
  ctx.textAlign="left"; ctx.font="26px sans-serif"; ctx.fillText(dstr,80,h-140);

  // Signature bottom right
  const sig=await loadImage(SIG_SRC); const sw=380; const sh=sig.height*(sw/sig.width);
  ctx.drawImage(sig,w-100-sw,h-260-sh,sw,sh);

  return canvas;
}

/* Preview modal */
async function previewCertificate(name,cls,mark,photo,type,index){
  const c=await renderCertificateCanvas(name,cls,mark,photo,index);
  const img=c.toDataURL("image/png");
  const modal=document.getElementById("previewModal");
  const previewImg=document.getElementById("previewImage");
  previewImg.src=img; modal.style.display="flex";

  previewImg.onclick=()=>{
    if(type==="png"){ const a=document.createElement("a"); a.href=img; a.download=`${name.replace(/\s+/g,'_')}.png`; a.click(); confetti(); }
    else if(type==="pdf"){ const { jsPDF } = window.jspdf; const pdf=new jsPDF({orientation:"portrait",unit:"px",format:[1125,1500]}); pdf.addImage(img,"PNG",0,0,1125,1500); pdf.save(`${name.replace(/\s+/g,'_')}.pdf`); confetti(); }
    else if(type==="print"){ const w=window.open(""); w.document.write(`<img src="${img}" style="width:100%">`); w.document.close(); setTimeout(()=>w.print(),500); confetti(); }
  }
}

function closePreview(){ document.getElementById("previewModal").style.display="none"; }
</script>
</body>
</html>
