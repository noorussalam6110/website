<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noorussalam Madrasa - Cash Payment System</title>
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #28b463;
            --accent: #d35400;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --border: #d5d8dc;
            --cash-green: #2ecc71;
            --track-blue: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Nirmala UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #154360 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-icon {
            font-size: 48px;
        }

        .logo-text h1 {
            font-size: 28px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .logo-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .arabic-text {
            font-family: 'Traditional Arabic', 'Segoe UI', sans-serif;
            font-size: 20px;
            margin-top: 10px;
            color: #f1c40f;
        }

        /* Login Section */
        .login-section {
            padding: 40px;
        }

        .login-tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
        }

        .login-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--dark);
        }

        .login-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Form Styles */
        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .form-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .form-title {
            font-size: 22px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .form-subtitle {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .input-with-icon {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        input {
            width: 100%;
            padding: 14px 14px 14px 45px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(40, 180, 99, 0.1);
        }

        /* SMS Preview */
        .sms-preview {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid var(--track-blue);
            font-size: 13px;
            line-height: 1.4;
        }

        .sms-header {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        /* Buttons */
        .btn {
            padding: 16px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(26, 82, 118, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--cash-green) 0%, #27ae60 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }

        /* Info Box */
        .info-box {
            background: #fff9e6;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid var(--warning);
            font-size: 13px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid var(--border);
            background: var(--light);
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .success { color: var(--success); }
        .error { color: var(--danger); }
        .warning { color: var(--warning); }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-confirmed { background: #d5f4e6; color: #27ae60; }
        .status-pending { background: #fdebd0; color: #f39c12; }

        /* Admin Dashboard */
        .admin-dashboard {
            padding: 30px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .payment-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 5px solid var(--cash-green);
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .amount-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            border: 2px dashed var(--cash-green);
            margin: 15px 0;
        }

        .recent-payments {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .payment-details {
            flex: 1;
        }

        .payment-name {
            font-weight: 600;
            color: var(--dark);
        }

        .payment-meta {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container" id="mainContainer">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üïå</div>
                <div class="logo-text">
                    <h1>NOORUSSALAM MADRASA</h1>
                    <div class="logo-subtitle">Cash Payment Confirmation System</div>
                    <div class="arabic-text">ŸÖÿØÿ±ÿ≥ÿ© ŸÜŸàÿ± ÿßŸÑÿ≥ŸÑÿßŸÖ</div>
                </div>
            </div>
        </div>

        <!-- Login Section -->
        <div class="login-section" id="loginSection">
            <div class="login-tabs">
                <div class="login-tab active" onclick="showTab('parent')">
                    Parent Login
                </div>
                <div class="login-tab" onclick="showTab('admin')">
                    Admin Login
                </div>
            </div>

            <!-- Parent Login Form -->
            <div class="form-container active" id="parentForm">
                <div class="form-header">
                    <div class="form-icon">üì±</div>
                    <div class="form-title">Parent Payment Tracking</div>
                    <div class="form-subtitle">Check payment status using registered mobile</div>
                </div>

                <div class="info-box">
                    <strong>üí° How it works:</strong> Enter your registered mobile number to check if your cash payment has been confirmed by admin.
                </div>

                <form id="trackForm">
                    <div class="form-group">
                        <label for="parentMobile">Registered Mobile Number *</label>
                        <div class="input-with-icon">
                            <span class="input-icon">üì±</span>
                            <input type="tel" id="parentMobile" required 
                                   placeholder="Enter 10-digit mobile number"
                                   pattern="[6-9]\d{9}"
                                   title="Valid Indian mobile number">
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Must be the mobile number registered with madrasa
                        </small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <span>üîç</span> Check Payment Status
                    </button>
                </form>

                <div class="sms-preview" style="margin-top: 20px;">
                    <div class="sms-header">
                        <span>Sample SMS You'll Receive:</span>
                        <span>üí¨</span>
                    </div>
                    <div>
                        <strong>Noorussalam Madrasa:</strong> ‚Çπ200 cash payment confirmed. Receipt: RCPT202403001. Thank you!
                    </div>
                </div>
            </div>

            <!-- Admin Login Form -->
            <div class="form-container" id="adminForm">
                <div class="form-header">
                    <div class="form-icon">üë®‚Äçüíº</div>
                    <div class="form-title">Admin Login</div>
                    <div class="form-subtitle">Secure access to confirm cash payments</div>
                </div>

                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminUsername">Username *</label>
                        <div class="input-with-icon">
                            <span class="input-icon">üë§</span>
                            <input type="text" id="adminUsername" required 
                                   placeholder="Enter admin username">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="adminPassword">Password *</label>
                        <div class="input-with-icon">
                            <span class="input-icon">üîê</span>
                            <input type="password" id="adminPassword" required 
                                   placeholder="Enter admin password">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <span>üîê</span> Admin Login
                    </button>
                </form>

                <div class="info-box">
                    <strong>‚ö†Ô∏è Important:</strong> Only authorized personnel can login. All actions are logged in Google Sheets.
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div class="admin-dashboard" id="adminDashboard" style="display: none;">
            <div class="admin-header">
                <div>
                    <h2 style="color: var(--primary);">Cash Payment Confirmation</h2>
                    <small style="color: #666;">Confirm when you receive cash from parents</small>
                </div>
                <button class="logout-btn" onclick="logoutAdmin()">
                    üö™ Logout
                </button>
            </div>

            <div class="payment-form">
                <h3 style="margin-bottom: 20px; color: var(--dark);">Confirm Cash Received</h3>
                
                <form id="cashConfirmationForm">
                    <div class="form-group">
                        <label for="adminParentMobile">Parent Mobile Number *</label>
                        <div class="input-with-icon">
                            <span class="input-icon">üì±</span>
                            <input type="tel" id="adminParentMobile" required 
                                   placeholder="Parent's registered mobile"
                                   pattern="[6-9]\d{9}">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="paymentMonth">Month *</label>
                            <select id="paymentMonth" required style="width: 100%; padding: 14px; border: 2px solid var(--border); border-radius: 8px;">
                                <option value="">Select Month</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentYear">Year *</label>
                            <select id="paymentYear" required style="width: 100%; padding: 14px; border: 2px solid var(--border); border-radius: 8px;">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                    </div>

                    <div class="amount-display">
                        ‚Çπ200
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">Monthly Fee</div>
                    </div>

                    <div class="form-group">
                        <label for="receivingAdmin">Your Name (Admin) *</label>
                        <div class="input-with-icon">
                            <span class="input-icon">üë§</span>
                            <input type="text" id="receivingAdmin" required 
                                   placeholder="Enter your name for record">
                        </div>
                    </div>

                    <div class="sms-preview">
                        <div class="sms-header">
                            <span>SMS to be sent:</span>
                            <span>üì±</span>
                        </div>
                        <div id="adminSMSPreview">
                            Noorussalam Madrasa: ‚Çπ200 cash payment confirmed. Receipt: [Auto]. Thank you!
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success">
                        <span>‚úÖ</span> Confirm Cash Received & Send SMS
                    </button>
                </form>
            </div>

            <div class="recent-payments">
                <h3 style="margin-bottom: 15px; color: var(--dark);">Recent Confirmations</h3>
                <div id="recentPaymentsList">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        Loading recent payments...
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>¬© 2024 Noorussalam Madrasa - Kerala, India</p>
            <div class="contact-info">
                <span>üìû +91 98765 43210</span>
                <span>üìß admin@noorussalam.edu.in</span>
            </div>
            <p style="margin-top: 10px; color: #888; font-size: 11px;">
                üí∞ Monthly Fee: ‚Çπ200 | Parents: 70 | Due Date: 5th of every month
            </p>
        </div>
    </div>

    <!-- Status Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-icon" id="statusIcon">üì±</div>
            <h2 style="color: var(--primary); margin-bottom: 15px;" id="statusTitle">Payment Status</h2>
            <p id="statusMessage">Checking payment status...</p>
            
            <div id="paymentDetails" style="display: none; text-align: left; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Amount:</span>
                    <strong>‚Çπ200</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Month:</span>
                    <strong id="detailMonth">-</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Status:</span>
                    <span class="status-badge" id="detailStatus">Pending</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Confirmed By:</span>
                    <strong id="detailAdmin">-</strong>
                </div>
            </div>

            <div class="sms-preview" id="statusSMS" style="display: none; margin: 15px 0; font-size: 12px;">
                <strong>SMS Sent:</strong> <span id="smsContent">-</span>
            </div>

            <div class="modal-actions">
                <button class="modal-btn" onclick="closeModal()" style="background: #95a5a6; color: white;">
                    Close
                </button>
                <button class="modal-btn" onclick="requestSMS()" id="smsBtn" style="display: none; background: var(--primary); color: white;">
                    üì± Request SMS
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-icon success">‚úÖ</div>
            <h2 style="color: var(--success); margin-bottom: 15px;">Success!</h2>
            <p id="successMessage">Operation completed successfully.</p>
            <div class="sms-preview" style="margin: 15px 0; text-align: left; font-size: 12px;">
                <strong>SMS Sent:</strong><br>
                <span id="successSMS">-</span>
            </div>
            <button class="modal-btn" onclick="closeModal()" style="background: var(--success); color: white; width: 100%;">
                OK
            </button>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-icon error">‚ùå</div>
            <h2 style="color: var(--danger); margin-bottom: 15px;">Error</h2>
            <p id="errorMessage">Something went wrong.</p>
            <button class="modal-btn" onclick="closeModal()" style="background: var(--danger); color: white; width: 100%;">
                Try Again
            </button>
        </div>
    </div>

    <script>
        // Google Sheets Configuration
        const GOOGLE_SHEET_ID = 'YOUR_GOOGLE_SHEET_ID_HERE'; // Replace with your Google Sheet ID
        const GOOGLE_SHEET_NAME = 'Payments';
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; // Replace with your Google Apps Script URL

        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'admin123' // Change this in production
        };

        // Demo parent data (70 parents)
        const DEMO_PARENTS = [];
        for (let i = 1; i <= 70; i++) {
            DEMO_PARENTS.push({
                mobile: `98765${(43210 + i).toString().padStart(5, '0')}`.slice(0, 10),
                name: `Parent ${i}`,
                studentId: `NSM2024${i.toString().padStart(3, '0')}`
            });
        }

        // Initialize
        let isAdminLoggedIn = false;

        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is already logged in
            const adminToken = localStorage.getItem('adminToken');
            if (adminToken && adminToken === 'loggedIn') {
                showAdminDashboard();
            }
            
            // Update SMS preview
            updateAdminSMSPreview();
        });

        // Show tab
        function showTab(tab) {
            // Update tabs
            document.querySelectorAll('.login-tab').forEach(tabElement => {
                tabElement.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update forms
            document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(tab + 'Form').classList.add('active');
        }

        // Parent form submission
        document.getElementById('trackForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const mobile = document.getElementById('parentMobile').value.trim();
            
            if (!mobile.match(/^[6-9]\d{9}$/)) {
                showError('Please enter a valid 10-digit Indian mobile number.');
                return;
            }
            
            await checkPaymentStatus(mobile);
        });

        // Admin login
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                // Successful login
                isAdminLoggedIn = true;
                localStorage.setItem('adminToken', 'loggedIn');
                showAdminDashboard();
            } else {
                showError('Invalid admin credentials. Please try again.');
            }
        });

        // Admin cash confirmation form
        document.getElementById('cashConfirmationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await confirmCashPayment();
        });

        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadRecentPayments();
        }

        // Logout admin
        function logoutAdmin() {
            isAdminLoggedIn = false;
            localStorage.removeItem('adminToken');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminLoginForm').reset();
        }

        // Update admin SMS preview
        function updateAdminSMSPreview() {
            const month = document.getElementById('paymentMonth').value || 'Month';
            const year = document.getElementById('paymentYear').value || 'Year';
            const sms = `Noorussalam Madrasa: ‚Çπ200 cash payment for ${month} ${year} confirmed. Receipt: [Auto]. Thank you!`;
            document.getElementById('adminSMSPreview').textContent = sms;
        }

        // Add event listeners for admin form changes
        document.getElementById('paymentMonth').addEventListener('change', updateAdminSMSPreview);
        document.getElementById('paymentYear').addEventListener('change', updateAdminSMSPreview);

        // Check payment status via Google Sheets
        async function checkPaymentStatus(mobile) {
            showModal('statusModal', 'üì±', 'Checking Status', 'Searching for payment records...');
            
            try {
                // In real implementation, fetch from Google Sheets
                // const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getPayment&mobile=${mobile}`);
                // const data = await response.json();
                
                // For demo, simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simulate finding payment
                const foundPayment = Math.random() > 0.3; // 70% chance of finding payment
                
                if (foundPayment) {
                    const months = ['January', 'February', 'March', 'April', 'May', 'June'];
                    const randomMonth = months[Math.floor(Math.random() * months.length)];
                    
                    document.getElementById('statusIcon').textContent = '‚úÖ';
                    document.getElementById('statusTitle').textContent = 'Payment Found';
                    document.getElementById('statusMessage').textContent = `Payment record found for mobile: ${mobile}`;
                    document.getElementById('paymentDetails').style.display = 'block';
                    document.getElementById('detailMonth').textContent = randomMonth + ' 2024';
                    document.getElementById('detailStatus').textContent = 'Confirmed';
                    document.getElementById('detailStatus').className = 'status-badge status-confirmed';
                    document.getElementById('detailAdmin').textContent = 'Brother Ahmed';
                    document.getElementById('statusSMS').style.display = 'block';
                    document.getElementById('smsContent').textContent = `Noorussalam Madrasa: ‚Çπ200 cash payment for ${randomMonth} 2024 confirmed. Receipt: RCPT2024${(randomMonth.length + 1).toString().padStart(2, '0')}001. Thank you!`;
                    document.getElementById('smsBtn').style.display = 'none';
                } else {
                    document.getElementById('statusIcon').textContent = '‚è≥';
                    document.getElementById('statusTitle').textContent = 'No Payment Found';
                    document.getElementById('statusMessage').textContent = `No confirmed payment found for ${mobile}. Payment might be pending confirmation.`;
                    document.getElementById('paymentDetails').style.display = 'none';
                    document.getElementById('statusSMS').style.display = 'none';
                    document.getElementById('smsBtn').style.display = 'block';
                }
                
            } catch (error) {
                showError('Failed to check payment status. Please try again.');
            }
        }

        // Confirm cash payment via Google Sheets
        async function confirmCashPayment() {
            const mobile = document.getElementById('adminParentMobile').value.trim();
            const month = document.getElementById('paymentMonth').value;
            const year = document.getElementById('paymentYear').value;
            const adminName = document.getElementById('receivingAdmin').value.trim();
            
            if (!mobile.match(/^[6-9]\d{9}$/)) {
                showError('Please enter a valid 10-digit mobile number.');
                return;
            }
            
            if (!month || !adminName) {
                showError('Please fill all required fields.');
                return;
            }
            
            // Generate receipt number
            const receiptNo = `RCPT${year}${(months.indexOf(month) + 1).toString().padStart(2, '0')}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
            
            // Prepare data for Google Sheets
            const paymentData = {
                mobile: mobile,
                month: month,
                year: year,
                amount: 200,
                adminName: adminName,
                receiptNo: receiptNo,
                timestamp: new Date().toLocaleString(),
                status: 'confirmed'
            };
            
            try {
                // In real implementation, save to Google Sheets
                // const response = await fetch(GOOGLE_SCRIPT_URL, {
                //     method: 'POST',
                //     mode: 'no-cors',
                //     body: JSON.stringify(paymentData)
                // });
                
                // For demo, simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Create SMS message
                const smsMessage = `Noorussalam Madrasa: ‚Çπ200 cash payment for ${month} ${year} confirmed. Receipt: ${receiptNo}. Thank you!`;
                
                // Show success
                document.getElementById('successMessage').textContent = `Cash payment confirmed and SMS sent to ${mobile}`;
                document.getElementById('successSMS').textContent = smsMessage;
                showModal('successModal');
                
                // Reset form
                document.getElementById('cashConfirmationForm').reset();
                document.getElementById('receivingAdmin').value = adminName; // Keep admin name
                updateAdminSMSPreview();
                
                // Reload recent payments
                loadRecentPayments();
                
            } catch (error) {
                showError('Failed to save payment. Please try again.');
            }
        }

        // Load recent payments
        async function loadRecentPayments() {
            try {
                // In real implementation, fetch from Google Sheets
                // const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getRecentPayments`);
                // const payments = await response.json();
                
                // For demo, simulate
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const demoPayments = [
                    { mobile: '9876543210', month: 'March', year: '2024', admin: 'Brother Ahmed', time: '2 hours ago' },
                    { mobile: '9876543211', month: 'March', year: '2024', admin: 'Brother Ali', time: '5 hours ago' },
                    { mobile: '9876543212', month: 'February', year: '2024', admin: 'Brother Ahmed', time: '1 day ago' }
                ];
                
                const container = document.getElementById('recentPaymentsList');
                container.innerHTML = '';
                
                demoPayments.forEach(payment => {
                    const item = document.createElement('div');
                    item.className = 'payment-item';
                    item.innerHTML = `
                        <div class="payment-details">
                            <div class="payment-name">${payment.mobile}</div>
                            <div class="payment-meta">${payment.month} ${payment.year} ‚Ä¢ ${payment.admin}</div>
                        </div>
                        <div style="font-size: 12px; color: #666;">
                            ${payment.time}
                        </div>
                    `;
                    container.appendChild(item);
                });
                
            } catch (error) {
                console.error('Failed to load recent payments:', error);
            }
        }

        // Request SMS
        function requestSMS() {
            const mobile = document.getElementById('parentMobile').value;
            showSuccess('SMS Requested', `Status update SMS has been requested for ${mobile}. You will receive it shortly.`);
        }

        // Modal functions
        function showModal(modalId, icon = 'üì±', title = 'Status', message = 'Processing...') {
            document.getElementById('statusIcon').textContent = icon;
            document.getElementById('statusTitle').textContent = title;
            document.getElementById('statusMessage').textContent = message;
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId = null) {
            if (modalId) {
                document.getElementById(modalId).style.display = 'none';
            } else {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        }

        function showSuccess(title, message) {
            document.getElementById('successMessage').textContent = message;
            showModal('successModal');
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            showModal('errorModal');
        }

        // Helper arrays
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    </script>

    <!-- Google Apps Script Code for Backend -->
    <script>
        /*
        GOOGLE APPS SCRIPT CODE (Save this in Google Apps Script):
        
        const SHEET_ID = 'YOUR_GOOGLE_SHEET_ID_HERE';
        const SHEET_NAME = 'Payments';

        function doPost(e) {
            try {
                const data = JSON.parse(e.postData.contents);
                const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
                
                // If sheet doesn't exist, create it with headers
                if (!sheet) {
                    const newSheet = SpreadsheetApp.openById(SHEET_ID).insertSheet(SHEET_NAME);
                    newSheet.getRange('A1:H1').setValues([[
                        'Timestamp', 'Mobile', 'Month', 'Year', 'Amount', 'ReceiptNo', 'AdminName', 'Status'
                    ]]);
                }
                
                // Add new row
                sheet.appendRow([
                    new Date(),
                    data.mobile,
                    data.month,
                    data.year,
                    data.amount,
                    data.receiptNo,
                    data.adminName,
                    'confirmed'
                ]);
                
                // Send SMS (you need to integrate with SMS API)
                sendSMS(data.mobile, `Noorussalam Madrasa: ‚Çπ${data.amount} cash payment for ${data.month} ${data.year} confirmed. Receipt: ${data.receiptNo}. Thank you!`);
                
                return ContentService
                    .createTextOutput(JSON.stringify({ success: true }))
                    .setMimeType(ContentService.MimeType.JSON);
                    
            } catch (error) {
                return ContentService
                    .createTextOutput(JSON.stringify({ success: false, error: error.toString() }))
                    .setMimeType(ContentService.MimeType.JSON);
            }
        }

        function doGet(e) {
            const action = e.parameter.action;
            const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
            
            if (action === 'getPayment') {
                const mobile = e.parameter.mobile;
                const data = sheet.getDataRange().getValues();
                const headers = data[0];
                
                // Find payment for this mobile
                for (let i = 1; i < data.length; i++) {
                    if (data[i][1] === mobile) { // Mobile is in column B
                        const payment = {};
                        headers.forEach((header, index) => {
                            payment[header] = data[i][index];
                        });
                        return ContentService
                            .createTextOutput(JSON.stringify({ success: true, payment }))
                            .setMimeType(ContentService.MimeType.JSON);
                    }
                }
                
                return ContentService
                    .createTextOutput(JSON.stringify({ success: false, message: 'No payment found' }))
                    .setMimeType(ContentService.MimeType.JSON);
                    
            } else if (action === 'getRecentPayments') {
                const data = sheet.getDataRange().getValues();
                const recent = data.slice(Math.max(data.length - 10, 1)).reverse(); // Last 10 payments
                
                const payments = recent.map(row => ({
                    timestamp: row[0],
                    mobile: row[1],
                    month: row[2],
                    year: row[3],
                    amount: row[4],
                    receiptNo: row[5],
                    adminName: row[6],
                    status: row[7]
                }));
                
                return ContentService
                    .createTextOutput(JSON.stringify({ success: true, payments }))
                    .setMimeType(ContentService.MimeType.JSON);
            }
        }

        function sendSMS(mobile, message) {
            // Integrate with SMS gateway like TextLocal, Twilio, or MSG91
            // Example with TextLocal:
            // const apiKey = 'YOUR_API_KEY';
            // const url = `https://api.textlocal.in/send/?apikey=${apiKey}&numbers=${mobile}&message=${encodeURIComponent(message)}&sender=NOORSL`;
            // UrlFetchApp.fetch(url);
            
            // For now, just log
            console.log(`SMS to ${mobile}: ${message}`);
        }
        
        DEPLOYMENT:
        1. Create Google Sheet with columns: Timestamp, Mobile, Month, Year, Amount, ReceiptNo, AdminName, Status
        2. Create Google Apps Script with above code
        3. Deploy as Web App (Execute as: Me, Who has access: Anyone)
        4. Copy the Web App URL and update GOOGLE_SCRIPT_URL in the HTML
        */
    </script>
</body>
</html>
