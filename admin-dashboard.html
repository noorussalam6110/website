<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body{font-family:Inter,system-ui,Arial;background:linear-gradient(135deg,#007bff,#00b894);color:#fff;min-height:100vh;padding:20px}
  .container{background:rgba(255,255,255,0.08);padding:18px;border-radius:12px}
  .logout-btn{background:#ff4757;border:none;padding:8px 14px;border-radius:8px;color:#fff;float:right}
  .action-btn{margin-right:6px}
</style>
</head>
<body>
  <div class="container">
    <h2>Admin Dashboard <button class="logout-btn" onclick="logout()">Logout</button></h2>
    <div class="row g-2 mb-3">
      <div class="col"><input id="username" class="form-control" placeholder="Username"></div>
      <div class="col"><input id="password" class="form-control" placeholder="Password"></div>
      <div class="col"><input id="fullname" class="form-control" placeholder="Full Name"></div>
      <div class="col"><input id="class" class="form-control" placeholder="Class"></div>
      <div class="col"><input id="admission" class="form-control" placeholder="Admission No"></div>
      <div class="col"><input id="email" class="form-control" placeholder="Email"></div>
    </div>
    <div class="mb-3">
      <button class="btn btn-success" onclick="addStudent()">âž• Add Student</button>
    </div>

    <div class="table-responsive">
      <table class="table table-dark table-striped">
        <thead><tr><th>Username</th><th>Password</th><th>Full Name</th><th>Class</th><th>Admission</th><th>Email</th><th>Action</th></tr></thead>
        <tbody id="studentTable"><tr><td colspan="7">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyCpTX0hO04d0O-8e1Hqe7MFNmjY5KCWxCxi5MqE5xfmRbu4blwfhWLaZxhEzv0xpwR/exec";

if(!localStorage.getItem('role') || localStorage.getItem('role')!=='admin') location.href='login.html';

async function fetchStudents(){
  const res = await fetch(scriptURL);
  const data = await res.json();
  const tbody = document.getElementById('studentTable');
  tbody.innerHTML = '';
  data.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td contenteditable="true">${r.username}</td>
      <td contenteditable="true">${r.password}</td>
      <td contenteditable="true">${r.fullname}</td>
      <td contenteditable="true">${r.class}</td>
      <td contenteditable="true">${r.admission}</td>
      <td contenteditable="true">${r.email}</td>
      <td>
        <button class="btn btn-sm btn-success action-btn" onclick="updateStudent(this)">Save</button>
        <button class="btn btn-sm btn-danger" onclick="deleteStudent('${r.username}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

async function addStudent(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username || !password) return alert('Fill required fields');
  const payload = { action:'addStudent', username, password, fullname:document.getElementById('fullname').value.trim(), class:document.getElementById('class').value.trim(), admission:document.getElementById('admission').value.trim(), email:document.getElementById('email').value.trim() };
  await fetch(scriptURL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  alert('Added'); fetchStudents();
}

async function updateStudent(btn){
  const row = btn.closest('tr');
  const tds = row.children;
  const username = tds[0].textContent.trim();
  const payload = {
    action: 'updateStudent',
    username,
    password: tds[1].textContent.trim(),
    fullname: tds[2].textContent.trim(),
    class: tds[3].textContent.trim(),
    admission: tds[4].textContent.trim(),
    email: tds[5].textContent.trim()
  };
  await fetch(scriptURL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  alert('Updated');
}

async function deleteStudent(username){
  if(!confirm('Delete '+username+'?')) return;
  await fetch(scriptURL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'deleteStudent', username }) });
  alert('Deleted'); fetchStudents();
}

function logout(){ localStorage.clear(); location.href='login.html'; }

fetchStudents();
</script>
</body>
</html>
